<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
  <title>NEURONA 1.0</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#fff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="NEURONA 1.0">
  <link rel="apple-touch-icon" href="https://i.ibb.co/XfKRzvcy/27.png">
  <link rel="icon" type="image/png" href="https://i.ibb.co/XfKRzvcy/27.png">
  <link rel="preload" as="image" href="https://i.ibb.co/Mk4WpHL9/25-1.png" imagesrcset="https://i.ibb.co/Mk4WpHL9/25-1.png">
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    body, textarea, button, .msg-content {
      font-family: Arial, 'Apple Color Emoji', 'Segoe UI Emoji', 'Noto Color Emoji', 'Noto Emoji', sans-serif;
    }
    html, body {
      width:100vw; height:100vh; min-height:100vh; min-width:100vw;
      background:#fff; color:#000;
      -webkit-font-smoothing:antialiased;
      -webkit-text-size-adjust:none;
      overflow:hidden;
    }
    body {
      width:100vw; height:100vh;
      display:flex; flex-direction:column;
      align-items:center; justify-content:flex-start;
      background-color:#fff !important; color:#000 !important;
      transition:background 0s,color 0s;
      position:relative;
      overflow:hidden;
    }
    body.dark {
      background: #17181a !important; color: #f2f2f2 !important;
      transition: background 0s, color 0s;
    }
    #bg {
      position:fixed; top:0; left:0; width:100vw; height:100vh;
      z-index:0; opacity:0;
      transition:opacity .8s cubic-bezier(.38,.85,.48,1.01);
      pointer-events:none;
    }
    #app {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: 100%;
      max-width: 360px;
      min-width: 230px;
      min-height: 420px;
      max-height: 92vh;
      height: 88vh;
      margin-top: 95px;
      margin-bottom: 18px;
      z-index:1; opacity:0;
      background: none;
      transition: opacity .8s cubic-bezier(.38,.85,.48,1.01);
      box-sizing: border-box;
    }
    body.shown #bg { opacity:0.27; }
    body.shown #app { opacity:1; }
    .top-bar {
      width:100vw; position:fixed; top:0; left:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      background:transparent; height:56px; padding:0;
      pointer-events:none; opacity:0;
      transition:opacity .4s;
    }
    body.shown .top-bar { opacity:1; pointer-events:all;}
    .top-bar-content {
      display:flex; align-items:center; height:56px; pointer-events:all;
      margin-left:18px;
    }
    .top-logo { width:36px; height:auto; margin-right:13px; transition:filter 0s;}
    .top-title {
      font-size:1.52rem; letter-spacing:.11em; font-weight:bold;
      color:#000; user-select:none;
      text-transform:uppercase;
      transition: color 0s;
    }
    .top-burger {
      display:flex; flex-direction:column; justify-content:center;
      width:36px; height:29px; margin-right:18px;
      cursor:pointer; pointer-events:all; gap:3.2px;
      z-index: 1110;
      transition: background 0s;
    }
    .top-burger span {
      display:block; height:5.6px; width:100%;
      background:#000; border-radius:4px; margin:0; transition:background 0s;
    }
    .top-burger span:last-child { margin-bottom:0; }
    .top-bar.hide { opacity:0; pointer-events:none; }

    #loader {
      position:fixed; inset:0; background:rgba(255,255,255,0.98);
      display:flex; align-items:center; justify-content:center;
      z-index:1001; flex-direction:column;
      opacity:1; pointer-events:auto;
      width: 100vw; height: 100vh;
      transition: opacity .6s, background .0s;
    }
    body.dark #loader { background: #17181a !important; }
    #loader.hide { opacity:0; pointer-events:none; }
    .loader-content {
      display:flex; align-items:center; justify-content:center;
      animation:fade 8s ease-in-out infinite;
      min-height:140px; min-width:270px;
    }
    .loader-logo { 
      width:110px; margin-right:18px; image-rendering: auto; 
      filter: none;
      opacity: 0;
      transition: filter 0s, opacity .4s;
    }
    .loader-text { display:flex; flex-direction:column; align-items:center; line-height:1.01; }
    .loader-title {
      font-size:5.3rem; font-weight:bold; letter-spacing:.14em; color:#000;
      text-shadow:0 1px 0 #fff, 0 4px 16px #bbb6;
      line-height:0.98; text-transform:uppercase;
      opacity: 0;
      transition: color 0s, opacity .4s;
    }
    .loader-subtitle {
      font-size:1.38rem; letter-spacing:.06em; color:#222; margin-top:5px;
      line-height:1.09; font-weight:500;
      opacity: 0;
      transition: color 0s, opacity .4s;
    }
    .loader-content.show .loader-logo,
    .loader-content.show .loader-title,
    .loader-content.show .loader-subtitle {
      opacity: 1;
    }
    body.dark .loader-logo { filter: invert(1); }
    body.dark .loader-title,
    body.dark .loader-subtitle { color: #fff; }
    @keyframes fade { 0%,100%{opacity:0;} 50%{opacity:1;} }

    .chat-container {
      background:rgba(255,255,255,0.93);
      border-radius:14px; border:1.6px solid #d1d1d1;
      box-shadow:0 7px 36px 0 rgba(30,40,80,0.19), 0 2.5px 10px 0 rgba(50,50,90,0.14);
      display:flex; flex-direction:column; overflow:hidden;
      width:100%; min-width:0;
      height:100%;
      min-height: 390px;
      max-height: 100%;
      transition: box-shadow 0.22s cubic-bezier(.3,.9,.3,1), border .27s, background 0s, color 0s;
      position:relative;
      margin:0 auto 0 auto;
      box-sizing: border-box;
    }
    body.dark .chat-container {
      background: #1b1c1e !important; color: #ececec;
      border-color: #323232;
    }
    #messages {
      flex:1; display:flex; flex-direction:column; padding:15px; overflow-y:auto;
      gap:7px; scroll-behavior: smooth;
      overscroll-behavior: contain;
      min-height: 100px;
      max-height: calc(88vh - 132px);
      box-sizing: border-box;
    }
    .message {
      display: flex;
      flex-direction: column;
      align-self: flex-start;
      position:relative;
      background:#e0e0e0;
      margin: 2px 0;
      padding:10px 15px 26px 12px;
      max-width:83%; min-width:70px;
      border-radius:12px 12px 12px 0;
      box-shadow:0 1.5px 5px #ccc3;
      word-break:break-word;
      line-height:1.48;
      font-size:1rem;
      color:#111;
      border:1.2px solid #d7d7d7;
      transition:background .0s, border .0s, color .0s;
    }
    .message.user {
      align-self:flex-end;
      background:#f5f5f5;
      border-radius:12px 12px 0 12px;
      color:#222;
      border:1.2px solid #d7d7d7;
    }
    .message.bot  { align-self:flex-start; }
    .message.typing {
      font-style:italic; color:#666;
      background: #ebebeb;
      min-width:60px;
      padding-bottom:14px;
    }
    body.dark .message, body.dark .message.user {
      background: #242428;
      color: #f5f5f7;
      border-color: #545458;
    }
    body.dark .message.user { background: #28282c; color: #eaeaea; }
    .msg-content { width: 100%; padding-bottom: 3px; }
    .msg-time {
      position:absolute;
      right:14px;
      bottom:6px;
      font-size:0.8em;
      color:#666;
      opacity:0.88;
      background:none !important;
      padding:0 2px 0 1px;
      border-radius: 6px;
      z-index:10;
      user-select:none;
      font-family:Arial,sans-serif;
      pointer-events: none;
      box-shadow: none;
      transition:.0s;
      display: none;
    }
    .neurona-title {
      font-weight:bold; font-size:2.05rem; letter-spacing:.10em; display:block;
      text-align:center; margin: 0 0 8px 0; text-transform:uppercase;
    }
    .input-area {
      display: flex;
      padding: 10px;
      background: #fff;
      align-items: flex-end;
      transition: background 0s;
    }
    body.dark .input-area { background: #1b1c1e; }
    #input {
      flex:1; resize:none; border:1px solid #ccc; padding:12px; border-radius:4px; height:50px; font-size:1rem;
      background: none;
      color: inherit;
      transition: background 0s, color 0s;
    }
    #send {
      margin-left:8px; padding:0 16px; border:none; border-radius:4px;
      background:#444; color:#fff; font-size:1rem; cursor:pointer; transition:background 0s,color 0s;
      min-width:44px; min-height:50px; height:50px; display: flex; align-items: center; justify-content: center;
      font-weight:bold;
      border:1.2px solid #d7d7d7;
    }
    body.dark #send { background:#fff; color:#000; border:1.2px solid #888;}
    #send:hover { background:#222; color:#fff; }
    body.dark #send:hover { background:#eee; color:#000; }

    .copy-btn {
      position: absolute;
      top: 4px; right: 3px;
      background: none; border: none; cursor: pointer; color: #888; font-size: 1.15em; opacity: 0.8; z-index: 15;
      display:none;
    }
    .message:hover .copy-btn { display:inline; }
    .message.user .copy-btn { color:#777; }
    .message.bot .copy-btn { color:#000; }
    ol, ul {
      margin: 12px 0 12px 15px;
      padding-left: 24px;
    }
    ol { list-style: decimal inside; }
    ul { list-style: disc inside; }
    li { margin-bottom: 5px; line-height: 1.5; }
    p { margin: 7px 0; }
    #scroll-down {
      display:none; position:absolute; left:50%; bottom:93px;
      transform:translateX(-50%);
      background:#fff; color:#222;
      border-radius:50%; box-shadow:0 3px 14px #0001;
      width:47px; height:47px; align-items:center; justify-content:center;
      cursor:pointer; font-size:2.4rem; border:none; outline:none;
      transition:.0s;
      opacity:0.93;
      z-index:99;
      border: 2.2px solid #eee;
      font-weight: bold;
      padding:0;
    }
    #scroll-down svg {
      width:27px; height:27px; display:block; stroke-width:4.2px;
      margin: 0 auto;
    }
    #scroll-down.show { display:flex; }
    #scroll-down:hover { background:#f0f0f0; }

    .side-menu-bg {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.22);
      z-index: 1101;
      opacity: 0; pointer-events: none;
      transition: opacity .2s;
    }
    .side-menu-bg.active {
      opacity: 1; pointer-events: auto;
    }
    .side-menu {
      position: fixed; top: 0; right: 0;
      width: 56vw; max-width: 420px; min-width: 230px;
      height: 100vh;
      background: var(--side-bg, #fff);
      color: var(--side-txt, #222);
      z-index: 1102;
      box-shadow: -9px 0 38px #0002;
      transform: translateX(120%);
      transition: transform .22s cubic-bezier(.64,.03,.32,1), background 0s, color 0s;
      display: flex; flex-direction: column;
      border-radius: 25px 0 0 25px;
      padding: 28px 0 0 0;
      overflow-y: auto;
      border-left: 1.8px solid #ededed;
    }
    .side-menu.active { transform: translateX(0); }
    .side-menu-list {
      display: flex; flex-direction: column;
      gap: 2px; margin: 0 0 18px 0; padding: 0 24px;
    }
    .side-menu-item {
      padding: 15px 0 12px 7px;
      font-size: 1.15rem;
      font-weight: bold;
      border-bottom: 1px solid #ececec;
      cursor: pointer; user-select: none;
      display: flex; align-items: center;
      gap: 12px;
      transition: background .0s;
      position: relative;
    }
    .side-menu-item:last-child { border-bottom: none; }
    .side-menu-item:active { background: #f7f7fa; }
    .side-arrow {
      margin-left: auto;
      transition: transform .12s;
      opacity: 0.6;
      width: 18px;
      height: 18px;
    }
    .side-menu-item.with-arrow .side-arrow { display:inline;}
    .side-menu-item .side-arrow { display:inline;}
    .settings-group {
      display:none; flex-direction:column; gap:0; margin:0; padding:0 0 0 0;
      margin-bottom: 0;
      border-top: none;
    }
    .settings-group.open { display:flex; }
    .side-switch-row {
      display: flex; align-items: center; justify-content: space-between;
      padding: 8px 0 8px 7px;
    }
    .side-switch-label { font-size: 1.06rem; font-weight: bold; }
    .lang-row-arrow {
      margin-left: 8px;
      opacity: 0.66;
      width: 18px;
      height: 18px;
      vertical-align: text-bottom;
    }
    .switch {
      width: 52px; height: 30px; background: #dedede;
      border-radius: 18px;
      position: relative; cursor: pointer;
      transition: none;
      margin-left: 5px;
      flex-shrink: 0;
      border: 1.4px solid #bcbcbc;
      box-shadow: 0 1.5px 4px #0001;
      display: flex; align-items: center;
      overflow: visible;
      will-change: background, border;
    }
    .switch-inner {
      width: 28px; height: 28px;
      background: #fff;
      border-radius: 50%;
      position: absolute; left: 1.4px; top: -1px;
      box-shadow: 0 2.5px 12px #bbb2;
      transition: none;
      border: 1.8px solid #d2d2d2;
      display: flex; align-items: center; justify-content: center;
      will-change: left;
    }
    .switch.on .switch-inner {
      left: 22px;
      background: #eee;
      border-color: #c7c7c7;
    }
    .switch:not(.on) .switch-inner {
      left: 1.4px;
      background: #fff;
      border-color: #d2d2d2;
    }
    body.dark .side-menu {
      --side-bg:#16171a; --side-txt:#eee; --side-muted:#999;
      background: #16171a; color: #eee;
      border-left: 2.3px solid #323232;
    }
    body.dark .side-menu-item { border-bottom: 1.3px solid #23232b; color: #fff; }
    body.dark .side-menu-item:active { background: #23232b; }
    body.dark .side-switch-row, body.dark .side-menu-section { color: #bfc7d2; }
    body.dark .switch {
      background: #23242a; border-color: #545458;
      box-shadow: 0 1.5px 6px #0003;
    }
    body.dark .switch.on {
      background: #ededed;
      border-color: #888;
    }
    body.dark .switch-inner {
      background: #141414;
      border-color: #23242a;
    }
    body.dark .switch.on .switch-inner {
      background: #dfdfdf;
      border-color: #bcbcbc;
    }

    .side-close-btn {
      position: absolute; top: 12px; right: 17px;
      width: 41px; height: 41px;
      background: none; border: none;
      font-size: 2.17rem; color: #888;
      cursor: pointer; border-radius: 100%;
      transition: background .15s;
      z-index: 1122;
      display: flex; align-items: center; justify-content: center;
    }
    .side-close-btn:active { background: #eee; }
    body.dark .side-close-btn { color: #aaa; }

    .side-langs {
      position: static;
      max-height: none;
      overflow-y: visible;
      border-radius: 9px;
      box-shadow: 0 3px 12px #0001;
      background: var(--side-bg, #fff);
      margin: 0 0 0 0; padding: 2px 0 6px 0;
      border: 1.1px solid #eee;
      left: 0; right: 0;
      z-index: 1111;
      display: none;
      animation: showLang .22s;
      width: 100%;
    }
    .side-langs.show { display: block; }
    .side-lang-item {
      padding: 13px 15px; font-size: 1.08rem;
      cursor: pointer;
      color: var(--side-txt, #111);
      transition: background .0s, color .0s;
      border-radius: 8px;
      user-select: none;
      font-weight: bold;
    }
    .side-lang-item.active, .side-lang-item:active {
      background: #ededed;
      color: #242428;
    }
    body.dark .side-langs { background: #16171a; border-color:#23252a; }
    body.dark .side-lang-item { color: #eee; }
    body.dark .side-lang-item.active, body.dark .side-lang-item:active {
      background: #262b35; color: #fff;
    }
    @media(max-width:600px){
      .top-bar{height:38px;}
      .top-bar-content{height:38px; margin-left:7px;}
      .top-logo{width:22px; margin-right:7px;}
      .top-title{font-size:1.03rem;}
      .top-burger{width:27px; height:18px; margin-right:7px;}
      .top-burger span{height:3.3px;}
      #app { max-width:94vw; min-width:0; padding:0 0 7px 0; height:84vh; margin-top:79px; }
      .chat-container { min-width:0; max-width:100vw; min-height:150px; height:100%;}
      #messages { min-height:60px; max-height:calc(84vh - 110px);}
      .loader-logo { width:70px; margin-right:7px; }
      .loader-title { font-size:2.4rem; }
      .loader-subtitle { font-size:1.03rem; }
      #input { font-size:.89rem; height:38px; }
      #send { font-size:.89rem; padding:0 10px; min-width:34px; min-height:38px; height:38px;}
      #scroll-down { width:35px; height:35px; font-size:1.3rem; bottom:82px;}
      #scroll-down svg { width:20px; height:20px; }
      #loader { min-height:280px; }
      .side-menu{ width:80vw; min-width:0; }
      .side-langs{ left: 0; right: 0; }
    }
    @media (max-width:400px){
      .loader-title{font-size:1.2rem;}
      #app{max-width:98vw;}
      .chat-container{min-height:80px;}
    }
    @media (max-height:450px){
      #app{min-height:100px; height:54vh;}
      .chat-container{min-height:60px;}
      #messages{min-height:35px;}
    }
  </style>
</head>
<body>
  <canvas id="bg"></canvas>
  <div class="top-bar" id="top-bar">
    <div class="top-bar-content">
      <img src="https://i.ibb.co/Mk4WpHL9/25-1.png" class="top-logo" alt="logo" id="mainLogo"/>
      <span class="top-title" id="mainTitle">NEURONA</span>
    </div>
    <div class="top-burger" id="burgerBtn">
      <span></span><span></span><span></span>
    </div>
  </div>
  <div class="side-menu-bg" id="sideMenuBg"></div>
  <nav class="side-menu" id="sideMenu" tabindex="-1">
    <button class="side-close-btn" id="sideCloseBtn" title="Close menu">&times;</button>
    <div class="side-menu-list">
      <div class="side-menu-item" id="profileMenu"><span></span></div>
      <div class="side-menu-item" id="subMenu"><span></span></div>
      <div class="side-menu-item with-arrow" id="settingsBtn">
        <span></span>
        <svg class="side-arrow" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div class="settings-group" id="settingsGroup">
        <div class="side-switch-row" id="notifRow">
          <span class="side-switch-label"></span>
          <div class="switch" id="notifSwitch">
            <div class="switch-inner"></div>
          </div>
        </div>
        <div class="side-switch-row" id="themeRow">
          <span class="side-switch-label"></span>
          <div class="switch" id="themeSwitch">
            <div class="switch-inner"></div>
          </div>
        </div>
        <div class="side-switch-row" id="langRow" style="cursor:pointer;">
          <span class="side-switch-label"></span>
          <svg class="lang-row-arrow" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.2" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="side-langs" id="langList"></div>
      </div>
    </div>
  </nav>
  <div id="loader">
    <div class="loader-content">
      <img src="https://i.ibb.co/Mk4WpHL9/25-1.png" class="loader-logo" alt="Logo" id="loaderLogo"/>
      <div class="loader-text">
        <div class="loader-title" id="loaderTitle">NEURONA</div>
        <div class="loader-subtitle" id="loaderSubtitle">PERSONAL AI ASSISTANT</div>
      </div>
    </div>
  </div>
  <div id="app">
    <div class="chat-container">
      <div id="messages"></div>
      <button id="scroll-down" title="Scroll to new">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div class="input-area">
        <textarea id="input" placeholder="Type a message..."></textarea>
        <button id="send">Send</button>
      </div>
    </div>
  </div>
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞ –∏ —Ç–µ–º—ã –î–û –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    let lang = localStorage.getItem('neurona_lang') || 'en';
    let theme = localStorage.getItem('neurona_theme');
    if(theme === 'dark') document.body.classList.add('dark');
    if(theme === 'dark') { document.getElementById('loader')?.classList.add('dark'); document.documentElement.style.background='#17181a'; }
    const langs = [
      {code:'en',name:'English'},
      {code:'ru',name:'–†—É—Å—Å–∫–∏–π'},
      {code:'ua',name:'–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞'},
      {code:'es',name:'Espa√±ol'},
      {code:'de',name:'Deutsch'},
      {code:'fr',name:'Fran√ßais'},
      {code:'it',name:'Italiano'},
      {code:'pl',name:'Polski'},
      {code:'tr',name:'T√ºrk√ße'},
      {code:'zh',name:'‰∏≠Êñá'}
    ];
    // –í—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    const dict = {
      en: {
        ph: "Type a message...",
        send: "Send",
        error: "Oops, something went wrong. Please try again!",
        internal: "Internal error, please try again later.",
        profile: "My profile",
        subscription: "Subscription",
        settings: "Settings",
        notifications: "Notifications",
        theme: "Theme",
        lang: "Interface language",
        assistant: "PERSONAL AI ASSISTANT"
      },
      ru: {
        ph: "–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...",
        send: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
        error: "–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞!",
        internal: "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
        profile: "–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å",
        subscription: "–ü–æ–¥–ø–∏—Å–∫–∞",
        settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
        notifications: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
        theme: "–¢–µ–º–∞",
        lang: "–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",
        assistant: "–ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ô AI –ê–°–°–ò–°–¢–ï–ù–¢"
      },
      ua: {
        ph: "–í–≤–µ–¥—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...",
        send: "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏",
        error: "–©–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑!",
        internal: "–í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.",
        profile: "–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å",
        subscription: "–ü—ñ–¥–ø–∏—Å–∫–∞",
        settings: "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è",
        notifications: "–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è",
        theme: "–¢–µ–º–∞",
        lang: "–ú–æ–≤–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É",
        assistant: "–ü–ï–†–°–û–ù–ê–õ–¨–ù–ò–ô AI –ê–°–ò–°–¢–ï–ù–¢"
      },
      es: {
        ph: "Escribe un mensaje...",
        send: "Enviar",
        error: "¬°Vaya, algo sali√≥ mal! Int√©ntalo de nuevo.",
        internal: "Error interno, int√©ntalo m√°s tarde.",
        profile: "Mi perfil",
        subscription: "Suscripci√≥n",
        settings: "Configuraci√≥n",
        notifications: "Notificaciones",
        theme: "Tema",
        lang: "Idioma de la interfaz",
        assistant: "ASISTENTE DE IA PERSONAL"
      },
      de: {
        ph: "Schreibe eine Nachricht...",
        send: "Senden",
        error: "Hoppla, etwas ist schief gelaufen. Bitte versuche es erneut!",
        internal: "Interner Fehler, bitte sp√§ter erneut versuchen.",
        profile: "Mein Profil",
        subscription: "Abonnement",
        settings: "Einstellungen",
        notifications: "Benachrichtigungen",
        theme: "Thema",
        lang: "Oberfl√§chensprache",
        assistant: "PERS√ñNLICHER KI-ASSISTENT"
      },
      fr: {
        ph: "√âcrivez un message...",
        send: "Envoyer",
        error: "Oups, quelque chose s'est mal pass√©. Veuillez r√©essayer¬†!",
        internal: "Erreur interne, veuillez r√©essayer plus tard.",
        profile: "Mon profil",
        subscription: "Abonnement",
        settings: "Param√®tres",
        notifications: "Notifications",
        theme: "Th√®me",
        lang: "Langue de l'interface",
        assistant: "ASSISTANT IA PERSONNEL"
      },
      it: {
        ph: "Scrivi un messaggio...",
        send: "Invia",
        error: "Ops, qualcosa √® andato storto. Riprova!",
        internal: "Errore interno, riprova pi√π tardi.",
        profile: "Il mio profilo",
        subscription: "Abbonamento",
        settings: "Impostazioni",
        notifications: "Notifiche",
        theme: "Tema",
        lang: "Lingua interfaccia",
        assistant: "ASSISTENTE PERSONALE IA"
      },
      pl: {
        ph: "Napisz wiadomo≈õƒá...",
        send: "Wy≈õlij",
        error: "Ups, co≈õ posz≈Ço nie tak. Spr√≥buj ponownie!",
        internal: "B≈ÇƒÖd wewnƒôtrzny, spr√≥buj p√≥≈∫niej.",
        profile: "M√≥j profil",
        subscription: "Subskrypcja",
        settings: "Ustawienia",
        notifications: "Powiadomienia",
        theme: "Motyw",
        lang: "Jƒôzyk interfejsu",
        assistant: "OSOBISTY ASYSTENT AI"
      },
      tr: {
        ph: "Bir mesaj yaz...",
        send: "G√∂nder",
        error: "Bir ≈üeyler ters gitti. L√ºtfen tekrar deneyin!",
        internal: "Dahili hata, l√ºtfen daha sonra tekrar deneyin.",
        profile: "Profilim",
        subscription: "Abonelik",
        settings: "Ayarlar",
        notifications: "Bildirimler",
        theme: "Tema",
        lang: "Aray√ºz dili",
        assistant: "Kƒ∞≈ûƒ∞SEL YAPAY ZEKA ASƒ∞STANI"
      },
      zh: {
        ph: "ËæìÂÖ•Ê∂àÊÅØ...",
        send: "ÂèëÈÄÅ",
        error: "ÂìéÂëÄÔºåÂá∫‰∫ÜÁÇπÈóÆÈ¢ò„ÄÇËØ∑ÂÜçËØï‰∏ÄÊ¨°ÔºÅ",
        internal: "ÂÜÖÈÉ®ÈîôËØØÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ",
        profile: "ÊàëÁöÑËµÑÊñô",
        subscription: "ËÆ¢ÈòÖ",
        settings: "ËÆæÁΩÆ",
        notifications: "ÈÄöÁü•",
        theme: "‰∏ªÈ¢ò",
        lang: "ÁïåÈù¢ËØ≠Ë®Ä",
        assistant: "‰∏™‰∫∫AIÂä©Êâã"
      }
    };

    // –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
    function updateInterfaceLang() {
      const t = dict[lang] || dict['en'];
      document.getElementById('profileMenu').querySelector('span').textContent = t.profile;
      document.getElementById('subMenu').querySelector('span').textContent = t.subscription;
      document.getElementById('settingsBtn').querySelector('span').textContent = t.settings;
      document.getElementById('notifRow').querySelector('.side-switch-label').textContent = t.notifications;
      document.getElementById('themeRow').querySelector('.side-switch-label').textContent = t.theme;
      document.getElementById('langRow').querySelector('.side-switch-label').textContent = t.lang + " (" + (langs.find(l=>l.code===lang)?.name||lang) + ")";
      document.getElementById('loaderSubtitle').textContent = t.assistant;
      document.getElementById('input').placeholder = t.ph;
      document.getElementById('send').textContent = t.send;
    }

    // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —è–∑—ã–∫–∞
    if(!dict[lang]) lang='en';
    updateInterfaceLang();

    // ========== SIDEMENU LOGIC ==========
    const sideMenu = document.getElementById('sideMenu');
    const sideMenuBg = document.getElementById('sideMenuBg');
    const burger = document.getElementById('burgerBtn');
    const closeBtn = document.getElementById('sideCloseBtn');
    burger.onclick = ()=>{ sideMenu.classList.add('active'); sideMenuBg.classList.add('active'); }
    closeBtn.onclick = ()=>{ sideMenu.classList.remove('active'); sideMenuBg.classList.remove('active'); }
    sideMenuBg.onclick = ()=>{ sideMenu.classList.remove('active'); sideMenuBg.classList.remove('active'); }
    document.addEventListener('keydown', e=>{
      if(e.key==='Escape' && sideMenu.classList.contains('active')) {
        sideMenu.classList.remove('active'); sideMenuBg.classList.remove('active');
      }
    });

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–µ–µ—Å—è –º–µ–Ω—é
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsGroup = document.getElementById('settingsGroup');
    let settingsOpen = false;
    settingsBtn.onclick = function() {
      settingsOpen = !settingsOpen;
      settingsGroup.classList.toggle('open',settingsOpen);
      settingsBtn.querySelector('.side-arrow').style.transform = settingsOpen ? "rotate(180deg)" : "rotate(0deg)";
      if(!settingsOpen) langList.classList.remove('show');
    };

    // –Ø–∑—ã–∫–∏ 
    const langRow = document.getElementById('langRow');
    const langList = document.getElementById('langList');
    langRow.onclick = (e)=>{
      langList.innerHTML = '';
      langs.forEach(l=>{
        const li = document.createElement('div');
        li.className = 'side-lang-item' + (l.code===lang?' active':'');
        li.textContent = l.name;
        li.onclick = ()=>{
          lang = l.code;
          localStorage.setItem('neurona_lang',lang);
          updateInterfaceLang();
          langList.classList.remove('show');
        };
        langList.appendChild(li);
      });
      langList.classList.toggle('show');
      e.stopPropagation();
    };
    document.body.addEventListener('click', ()=>{ langList.classList.remove('show'); });

    // –¢–Å–ú–ù–ê–Ø –¢–ï–ú–ê: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏ –ø–ª–∞–≤–Ω–æ, –±–µ–∑ –≥–ª—é–∫–æ–≤
    const themeSwitch = document.getElementById('themeSwitch');
    const mainLogo = document.getElementById('mainLogo');
    const loaderLogo = document.getElementById('loaderLogo');
    const mainTitle = document.getElementById('mainTitle');
    const loaderTitle = document.getElementById('loaderTitle');
    const loaderSubtitle = document.getElementById('loaderSubtitle');
    function applyTheme(dark){
      document.body.classList.toggle('dark',dark);
      if(dark){
        mainLogo.style.filter = "invert(1)";
        loaderLogo.style.filter = "invert(1)";
        mainTitle.style.color = "#fff";
        loaderTitle.style.color = "#fff";
        loaderSubtitle.style.color = "#fff";
        Array.from(burger.children).forEach(span=>span.style.background='#fff');
        document.getElementById('loader').classList.add('dark');
        document.documentElement.style.background='#17181a';
      } else {
        mainLogo.style.filter = "";
        loaderLogo.style.filter = "";
        mainTitle.style.color = "#000";
        loaderTitle.style.color = "#000";
        loaderSubtitle.style.color = "#222";
        Array.from(burger.children).forEach(span=>span.style.background='#000');
        document.getElementById('loader').classList.remove('dark');
        document.documentElement.style.background='#fff';
      }
      themeSwitch.classList.toggle('on',dark);
    }
    function setTheme(dark){
      localStorage.setItem('neurona_theme',dark?'dark':'light');
      applyTheme(dark);
    }
    themeSwitch.onclick = ()=>{ setTheme(!document.body.classList.contains('dark')); };
    (()=>{ applyTheme(localStorage.getItem('neurona_theme')==='dark'); })();

    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (—Ñ–µ–π–∫-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)
    const notifSwitch = document.getElementById('notifSwitch');
    function setNotif(on){
      notifSwitch.classList.toggle('on',on);
      localStorage.setItem('neurona_notif',on?'on':'off');
    }
    notifSwitch.onclick = ()=>{ setNotif(notifSwitch.classList.contains('on')?false:true); };
    (()=>{ setNotif(localStorage.getItem('neurona_notif')==='on'); })();

    // ========== –ß–ê–¢ ==========
    const input = document.getElementById('input'),
          sendBtn = document.getElementById('send'),
          msgsContainer = document.getElementById('messages'),
          scrollDownBtn = document.getElementById('scroll-down');
    input.placeholder = dict[lang].ph;
    sendBtn.textContent = dict[lang].send;

    let messages = [], typingProcess = null, botIsTyping = false;

    function saveHistory(){ localStorage.setItem('neurona_history', JSON.stringify(messages)); }
    function loadHistory(){
      const h = JSON.parse(localStorage.getItem('neurona_history')||'[]');
      if(h.length){
        messages=h;
        msgsContainer.innerHTML = '';
        h.forEach(m=> addMessage(m.content,m.role,m.time));
        scrollChatToBottom(true);
      }
    }

    // Loader logo/text smooth show (and hide top-bar on load)
    function showLoaderContent(){
      let lcont = document.querySelector('.loader-content');
      lcont.classList.add('show');
    }
    setTimeout(showLoaderContent, 100);

    document.body.style.opacity = "1";
    window.addEventListener('load', ()=>{
      setTimeout(()=>{
        document.getElementById('top-bar').classList.add('hide');
        setTimeout(()=>{
          document.getElementById('loader').classList.add('hide');
          setTimeout(()=>{
            document.body.classList.add('shown');
            document.getElementById('loader').style.display='none';
            document.getElementById('top-bar').classList.remove('hide');
            loadHistory();
            setTimeout(()=>scrollChatToBottom(true), 200);
          }, 700);
        }, 1200);
      }, 400);
    });

    function formatBotMessage(text) {
      text = text.replace(/[\u{FE00}-\u{FE0F}]/gu, "");
      text = text.replace(/\uFFFD/g, "");
      text = text.replace(/\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g, '<a href="$2" target="_blank"><b>$1</b></a>');
      text = text.replace(/\*\*([^\*]+)\*\*/g, '<b>$1</b>');
      text = text.replace(/(^|\n)((?:\d+\.\s.*\n?)+)/gm, (m, p1, block) => {
        const items = block.trim().split(/\n/).filter(Boolean);
        let out = '<ol>';
        for(let i=0; i<items.length; ++i){
          out += `<li>${items[i].replace(/^\d+\.\s?/, '')}</li>`;
        }
        out += '</ol>';
        return p1 + out;
      });
      text = text.replace(/(^|\n)((?:^[-‚Ä¢]\s.+\n?)+)/gm, (m, p1, block) => {
        const items = block.trim().split(/\n/).filter(Boolean);
        let out = '<ul>';
        for(let i=0; i<items.length; ++i){
          out += '<li>' + items[i].replace(/^[-‚Ä¢]\s?/, '').trim() + '</li>';
        }
        out += '</ul>';
        return p1 + out;
      });
      text = text.replace(/\n{2,}/g, '</p><p>');
      text = text.replace(/\n/g, '<br>');
      if (!/^<p>/.test(text)) text = '<p>' + text;
      text = text.replace(/(<ol>|<ul>)/g, '</p>$1<p>');
      text = text.replace(/<\/ol>|<\/ul>/g, '$&<p>');
      text = text.replace(/<p><\/p>/g, '');
      return text;
    }

    function addMessage(text, who, time){
      if (!time) time = new Date().toLocaleTimeString().slice(0,5);
      const msg = document.createElement('div');
      msg.className = `message ${who}`;
      const content = document.createElement('div');
      content.className = 'msg-content';
      if (who === "bot") {
        content.innerHTML = formatBotMessage(text);
      } else if (who === "user") {
        content.innerHTML = text.replace(/(https?:\/\/[^\s<]+)/g, '<a href="$1" target="_blank">$1</a>');
      } else {
        content.textContent = text;
      }
      msg.appendChild(content);
      const timeEl = document.createElement('span');
      timeEl.className = 'msg-time';
      timeEl.textContent = time;
      msg.appendChild(timeEl);
      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.title = 'Copy';
      copyBtn.innerHTML = '‚ßâ';
      copyBtn.onclick = function(e) {
        e.stopPropagation();
        navigator.clipboard.writeText(content.innerText || content.textContent || "");
        copyBtn.innerHTML = '‚úî';
        setTimeout(()=>copyBtn.innerHTML='‚ßâ',800);
      };
      msg.appendChild(copyBtn);
      msgsContainer.appendChild(msg);
      setTimeout(()=>{timeEl.style.display='inline'}, 80);
      scrollChatToBottom(true);
    }

    function addTyping(){
      const d = document.createElement('div');
      d.className = 'message bot typing';
      d.textContent = '‚Ä¶';
      msgsContainer.appendChild(d);
      scrollChatToBottom();
      return d;
    }

    function scrollChatToBottom(smooth){
      setTimeout(()=>{
        if(smooth && 'scrollTo' in msgsContainer){
          msgsContainer.scrollTo({ top: msgsContainer.scrollHeight, behavior: "auto" });
        } else {
          msgsContainer.scrollTop = msgsContainer.scrollHeight;
        }
        checkScrollBtn();
      }, 1);
    }

    function checkScrollBtn(){
      if(botIsTyping) {
        scrollDownBtn.classList.remove('show');
        return;
      }
      let view = msgsContainer.clientHeight;
      let fromBottom = msgsContainer.scrollHeight - msgsContainer.scrollTop - view;
      if(fromBottom > view*0.99) {
        scrollDownBtn.classList.add('show');
      } else {
        scrollDownBtn.classList.remove('show');
      }
    }
    msgsContainer.addEventListener('scroll', checkScrollBtn);
    scrollDownBtn.onclick = ()=>{
      msgsContainer.scrollTo({ top: msgsContainer.scrollHeight, behavior: "auto" });
      scrollDownBtn.classList.remove('show');
    };

    // ========== –ë–´–°–¢–†–´–ô –û–¢–í–ï–¢ –ù–ê "–ï–¢–ê–ü–´" ========== 
    const etapRegex = /–µ—Ç–∞–ø|—ç—Ç–∞–ø|fastapi|huggingface|mistral|openchat|sqlite|redis|tauri|docker|ci\/cd|github actions|s3|r2|cloudflare|infra|api|–º–æ–¥—É–ª–∏|ocr|tesseract|coingecko|newsapi|health|finance|pdf|docx|fetcher\.py|–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä|—ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä|–º–∞—Å—à—Ç–∞–±|—Ä–∞–∑–≥–æ—Ä—Ç|—Ä–∞–∑–≤–µ—Ä—Ç|—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞|—Å—Ç—Ä—É–∫—Ç—É—Ä|–∞—Ä—Ö–∏—Ç–µ–∫—Ç|—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω|–µ—Å—Ç—å —ç—Ç–æ|–æ–±–ª–∞–¥–∞–µ—Ç —ç—Ç–∏–º|—Ç—ã —É–º–µ–µ—à—å/i;
    const etapFullAnswer = `<b>–í—Å–µ —ç—Ç–∞–ø—ã, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø–µ—Ä–µ—á–∏—Å–ª–∏–ª–∏, —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ NEURONA!</b><br>
–ú–æ—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:<br>
<ul>
<li>LLM —á–µ—Ä–µ–∑ HuggingFace (Mistral, OpenChat)</li>
<li>–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—É—é –ø–∞–º—è—Ç—å –Ω–∞ SQLite/Redis</li>
<li>FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (/chat, /memory, /modules)</li>
<li>–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π UI –Ω–∞ Flutter/Tauri/Web</li>
<li>–ú–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (Crypto, News, Docs, Health, Finance)</li>
<li>API: CoinGecko, NewsAPI, Apple Health, Yahoo Finance</li>
<li>OCR: Tesseract, DOCX, PDF</li>
<li>Docker, CI/CD, S3, Cloudflare, NGINX, HTTPS, Firewall</li>
</ul>
–í—Å—ë —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º" –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞, —á—Ç–æ–±—ã —Ç—ã –ø–æ–ª—É—á–∞–ª –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è! üöÄ<br>
–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ ‚Äî –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –ª—é–±–æ–≥–æ –∏–∑ —ç—Ç–∞–ø–æ–≤.`;

    function smartEtapAnswer(q) {
      if (etapRegex.test(q)) {
        return etapFullAnswer;
      }
      return null;
    }

    sendBtn.onclick = async ()=>{
      const txt = input.value.trim();
      if(!txt) return;
      const nowTime = new Date().toLocaleTimeString().slice(0,5);

      let etapAns = smartEtapAnswer(txt);
      if (etapAns) {
        addMessage(txt,'user',nowTime);
        input.value='';
        messages.push({ role:'user', content:txt, time: nowTime });
        const typing = addTyping();
        setTimeout(()=>{
          typing.remove();
          addMessage(etapAns, 'bot', new Date().toLocaleTimeString().slice(0,5));
          messages.push({ role:'assistant', content:etapAns, time: new Date().toLocaleTimeString().slice(0,5) });
          saveHistory();
          scrollChatToBottom(true);
        }, 700 + Math.random()*500);
        return;
      }

      addMessage(txt,'user',nowTime);
      input.value='';
      messages.push({ role:'user', content:txt, time: nowTime });

      const typing = addTyping();
      botIsTyping = true;

      // ... —Ç—É—Ç –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ ... (—Å–µ—Ä–≤–∏—Å–Ω—ã–µ API –∏ snapshot –Ω–µ –≤–∫–ª—é—á–µ–Ω—ã –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏)

      // –≠–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:
      setTimeout(()=>{
        typing.remove();
        const reply = "Your answer from the assistant will appear here. This is a test reply to check smooth scrolling and typing effect.";
        typeWriterEffect(reply,'bot',new Date().toLocaleTimeString().slice(0,5),()=>{botIsTyping = false; checkScrollBtn();});
        messages.push({ role:'assistant', content:reply, time: new Date().toLocaleTimeString().slice(0,5) });
        saveHistory();
        scrollChatToBottom(true);
      }, 700);
    };

    function typeWriterEffect(text, who, time, cb) {
      const msg = document.createElement('div');
      msg.className = `message ${who}`;
      const content = document.createElement('div');
      content.className = 'msg-content';
      msg.appendChild(content);
      const timeEl = document.createElement('span');
      timeEl.className = 'msg-time';
      timeEl.textContent = time;
      msg.appendChild(timeEl);
      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.title = 'Copy';
      copyBtn.innerHTML = '‚ßâ';
      copyBtn.onclick = function(e) {
        e.stopPropagation();
        navigator.clipboard.writeText(content.innerText || content.textContent || "");
        copyBtn.innerHTML = '‚úî';
        setTimeout(()=>copyBtn.innerHTML='‚ßâ',800);
      };
      msg.appendChild(copyBtn);
      msgsContainer.appendChild(msg);
      let i = 0;
      let formatted = formatBotMessage(text);
      timeEl.style.display = 'none';
      botIsTyping = true;

      function type() {
        if (i <= formatted.length) {
          content.innerHTML = formatted.slice(0, i);
          scrollChatToBottom(true);
          i += Math.floor(Math.random()*4)+4;
          setTimeout(type, 1);
        } else {
          timeEl.style.display = 'inline';
          botIsTyping = false;
          if (cb) cb();
        }
      }
      type();
    }

    input.addEventListener('keydown', function(e){
      if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        sendBtn.click();
      }
    });

    setTimeout(()=>{scrollChatToBottom(true)}, 200);
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js');
    }
  </script>
</body>
</html>
